ðŸš€ COMANDO FINAL: 21 TABLAS RESTANTES
===================================

ðŸ“‹ EJECUTAR EN SUPABASE QUERY EDITOR:

-- ===============================================
-- TABLAS DE ACTIVACIÃ“N Y RECUPERACIÃ“N
-- ===============================================

CREATE TABLE IF NOT EXISTS activaciones (
    id INTEGER NOT NULL PRIMARY KEY,
    usuario_id INTEGER,
    codigo VARCHAR(100),
    tipo VARCHAR(50),
    usado BOOLEAN DEFAULT false,
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    fecha_expiracion TIMESTAMP
);

CREATE TABLE IF NOT EXISTS cambios_contrasena (
    id INTEGER NOT NULL PRIMARY KEY,
    usuario_id INTEGER,
    token VARCHAR(255),
    usado BOOLEAN DEFAULT false,
    fecha_solicitud TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    fecha_expiracion TIMESTAMP,
    ip_address VARCHAR(45)
);

CREATE TABLE IF NOT EXISTS recuperacion_contrasena (
    id INTEGER NOT NULL PRIMARY KEY,
    usuario_id INTEGER,
    token VARCHAR(255),
    usado BOOLEAN DEFAULT false,
    fecha_solicitud TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    fecha_expiracion TIMESTAMP
);

-- ===============================================
-- TABLAS DE LECTORES Y REVISIONES
-- ===============================================

CREATE TABLE IF NOT EXISTS lectores (
    id INTEGER NOT NULL PRIMARY KEY,
    usuario_id INTEGER,
    fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    preferencias_lectura TEXT,
    libros_favoritos TEXT
);

CREATE TABLE IF NOT EXISTS revisiones_libros (
    id INTEGER NOT NULL PRIMARY KEY,
    libro_id INTEGER,
    revisor_id INTEGER,
    calificacion INTEGER,
    comentarios TEXT,
    estado VARCHAR(50),
    fecha_revision TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS correcciones_libros (
    id INTEGER NOT NULL PRIMARY KEY,
    libro_id INTEGER,
    corrector_id INTEGER,
    tipo_correccion VARCHAR(100),
    observaciones TEXT,
    estado VARCHAR(50),
    fecha_correccion TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS descargas (
    id INTEGER NOT NULL PRIMARY KEY,
    usuario_id INTEGER,
    libro_id INTEGER,
    fecha_descarga TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ip_address VARCHAR(45),
    formato VARCHAR(20)
);

-- ===============================================
-- TABLAS DE CAMPAÃ‘AS COMPARTIDAS
-- ===============================================

CREATE TABLE IF NOT EXISTS campana_compartidas (
    id INTEGER NOT NULL PRIMARY KEY,
    campana_id INTEGER,
    usuario_compartido_id INTEGER,
    fecha_compartida TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    permisos VARCHAR(100)
);

CREATE TABLE IF NOT EXISTS campanas_compartidas_admin (
    id INTEGER NOT NULL PRIMARY KEY,
    campana_id INTEGER,
    admin_id INTEGER,
    usuario_objetivo_id INTEGER,
    fecha_compartida TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    activa BOOLEAN DEFAULT true
);

CREATE TABLE IF NOT EXISTS campana_distribucion (
    id INTEGER NOT NULL PRIMARY KEY,
    campana_id INTEGER,
    canal VARCHAR(100),
    parametros TEXT,
    estado VARCHAR(50),
    fecha_programada TIMESTAMP,
    fecha_ejecutada TIMESTAMP
);

CREATE TABLE IF NOT EXISTS campana_envios (
    id INTEGER NOT NULL PRIMARY KEY,
    campana_id INTEGER,
    usuario_id INTEGER,
    email VARCHAR(255),
    estado VARCHAR(50),
    fecha_envio TIMESTAMP,
    fecha_apertura TIMESTAMP,
    fecha_click TIMESTAMP
);

CREATE TABLE IF NOT EXISTS campana_tracking (
    id INTEGER NOT NULL PRIMARY KEY,
    campana_id INTEGER,
    usuario_id INTEGER,
    accion VARCHAR(100),
    valor VARCHAR(255),
    fecha_accion TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS campanas_libros (
    id INTEGER NOT NULL PRIMARY KEY,
    campana_id INTEGER,
    libro_id INTEGER,
    precio_especial DECIMAL(10,2),
    descuento DECIMAL(5,2),
    fecha_inicio TIMESTAMP,
    fecha_fin TIMESTAMP
);

-- ===============================================
-- TABLAS DE SISTEMA Y LOGS
-- ===============================================

CREATE TABLE IF NOT EXISTS sesiones (
    id INTEGER NOT NULL PRIMARY KEY,
    usuario_id INTEGER,
    token VARCHAR(255),
    ip_address VARCHAR(45),
    user_agent TEXT,
    fecha_inicio TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    fecha_expiracion TIMESTAMP,
    activa BOOLEAN DEFAULT true
);

CREATE TABLE IF NOT EXISTS system_logs (
    id INTEGER NOT NULL PRIMARY KEY,
    nivel VARCHAR(50),
    mensaje TEXT,
    contexto TEXT,
    usuario_id INTEGER,
    ip_address VARCHAR(45),
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS email_logs (
    id INTEGER NOT NULL PRIMARY KEY,
    destinatario VARCHAR(255),
    asunto VARCHAR(255),
    mensaje TEXT,
    estado VARCHAR(50),
    fecha_envio TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    respuesta_servidor TEXT
);

CREATE TABLE IF NOT EXISTS log_actividad (
    id INTEGER NOT NULL PRIMARY KEY,
    usuario_id INTEGER,
    accion VARCHAR(255),
    tabla_afectada VARCHAR(100),
    registro_id INTEGER,
    datos_anteriores TEXT,
    datos_nuevos TEXT,
    ip_address VARCHAR(45),
    fecha_accion TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ===============================================
-- TABLAS DE NOTIFICACIONES Y CONFIGURACIÃ“N
-- ===============================================

CREATE TABLE IF NOT EXISTS notificaciones_escritores (
    id INTEGER NOT NULL PRIMARY KEY,
    escritor_id INTEGER,
    tipo VARCHAR(100),
    titulo VARCHAR(255),
    mensaje TEXT,
    leida BOOLEAN DEFAULT false,
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS usuario_configuracion_notificaciones (
    id INTEGER NOT NULL PRIMARY KEY,
    usuario_id INTEGER,
    tipo_notificacion VARCHAR(100),
    activa BOOLEAN DEFAULT true,
    medio VARCHAR(50),
    configuracion TEXT
);

CREATE TABLE IF NOT EXISTS pagos_comisiones (
    id INTEGER NOT NULL PRIMARY KEY,
    comision_id INTEGER,
    monto DECIMAL(12,2),
    metodo_pago VARCHAR(50),
    referencia_pago VARCHAR(255),
    estado VARCHAR(50) DEFAULT 'pendiente',
    fecha_pago TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ===============================================
-- VERIFICACIÃ“N FINAL DE TODAS LAS TABLAS
-- ===============================================

SELECT 'activaciones' as tabla, COUNT(*) as registros FROM activaciones
UNION ALL SELECT 'cambios_contrasena', COUNT(*) FROM cambios_contrasena
UNION ALL SELECT 'recuperacion_contrasena', COUNT(*) FROM recuperacion_contrasena
UNION ALL SELECT 'lectores', COUNT(*) FROM lectores
UNION ALL SELECT 'revisiones_libros', COUNT(*) FROM revisiones_libros
UNION ALL SELECT 'correcciones_libros', COUNT(*) FROM correcciones_libros
UNION ALL SELECT 'descargas', COUNT(*) FROM descargas
UNION ALL SELECT 'campana_compartidas', COUNT(*) FROM campana_compartidas
UNION ALL SELECT 'campanas_compartidas_admin', COUNT(*) FROM campanas_compartidas_admin
UNION ALL SELECT 'campana_distribucion', COUNT(*) FROM campana_distribucion
UNION ALL SELECT 'campana_envios', COUNT(*) FROM campana_envios
UNION ALL SELECT 'campana_tracking', COUNT(*) FROM campana_tracking
UNION ALL SELECT 'campanas_libros', COUNT(*) FROM campanas_libros
UNION ALL SELECT 'sesiones', COUNT(*) FROM sesiones
UNION ALL SELECT 'system_logs', COUNT(*) FROM system_logs
UNION ALL SELECT 'email_logs', COUNT(*) FROM email_logs
UNION ALL SELECT 'log_actividad', COUNT(*) FROM log_actividad
UNION ALL SELECT 'notificaciones_escritores', COUNT(*) FROM notificaciones_escritores
UNION ALL SELECT 'usuario_configuracion_notificaciones', COUNT(*) FROM usuario_configuracion_notificaciones
UNION ALL SELECT 'pagos_comisiones', COUNT(*) FROM pagos_comisiones;

ðŸŽ¯ RESULTADO ESPERADO:
- 20 tablas nuevas creadas
- Progreso: 34/35 tablas = 97%
- Â¡MIGRACIÃ“N CASI COMPLETA! ðŸŽ‰

ðŸš€ DESPUÃ‰S DE EJECUTAR:
Â¡TendrÃ¡s prÃ¡cticamente TODO el sistema Publiery migrado a Supabase!